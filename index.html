<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Skypixel - Average Color Viewer</title>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: sans-serif;
    }

    .row {
      margin-bottom: 24px;
    }

    .row p {
      margin: 0 0 8px;
    }

    .color-grid {
      display: flex;
      flex-wrap: wrap;
    }

    .color-box {
      width: 20px;
      height: 20px;
      margin: 0px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
  </style>
</head>

<body>
  <h1>SkyPixels</h1>
  <p>See the <a href='https://github.com/funvill/skypixel'>Skypixel</a> project page for more information</p>

  <script>
    // All the folders that contain the JSON files
    const folders = [
      "-zgjmZ_nZLI",
      "2G7bdqbL1EU",
      "4MK3E9EWDSY",
      "alberta-springbank-airport-cybw",
      "AovvFApVnKc",
      "british-columbia-vancouver-airport-cyvr",
      "calgary-12ave-5st",
      "dFBRpHHwQeg",
      "DnUFAShZKus",
      "dQzt2xtk7kY",
      "Fq-P0bdelRs",
      "Fw9hgttWzIg",
      "g2HGBY2v-wo",
      "GTQQdQ8VVKI",
      "Hcl9l2Z8mTI",
      "I-7mv4-BJ7M",
      "IEhDUXECe_k",
      "IRIAXc0iT9A",
      "JVQaZtahjwg",
      "kC6_JqEt3GA",
      "KTKN8RbYefQ",
      "LENLyDDEtUM",
      "lLELhY85VxI",
      "manitoba-dauphin-cydn",
      "manitoba-minnedosa-hwy10",
      "MwcqP3ta6RI",
      "new-brunswick-bathurst-airport-czbf",
      "new-brunswick-saint-john-millidgeville",
      "new-brunswick-saint-john-rte1",
      "new-brunswick-waweig-rte1",
      "newfoundland-cartwright-airport-cyca",
      "newfoundland-paddys-pond",
      "nova-scotia-port-hawkesbury-cypd",
      "nunavut-arviat-airport-cyek",
      "nwt-arviat-airport-cyek",
      "ontario-armstrong-airport-cyyw",
      "princeedwardisland-st-peters-hwy2",
      "Pwt0tZlt9eE",
      "qqSa53vxgBY",
      "quebec-st-hubert-airport-cyhu",
      "regina-bypass-tower",
      "s2rzmSNpyns",
      "saskatchewan-north-battleford-cyqw",
      "SDGEHMh3WOA",
      "T0oUufecXeE",
      "vLawo-FrBKk",
      "Y28zZGsYkjg",
      "yukon-braeburn-airport-cek2",
    ];

    // Each of these folders contains two JSON files 
    // 1. output.json - contains the average color for each frame    
    // 2. settings.json - contains the title, and description of the webcam



    folders.forEach(folder => {
      const row = document.createElement('div');
      row.className = 'row';
      const header = document.createElement('p');
      row.appendChild(header);

      // Get the title from settings.json
      header.innerHTML = folder;
      fetch(`./images/${folder}/settings.json`)
        .then(res => res.json())
        .then(data => {

          let description = '';
          if (data.description !== undefined && data.description.length > 0) {
            description = ' - ' + data.description;
          }


          if (data.title === undefined || data.title.length === 0) {
            header.innerHTML = folder;
          } else {

            // If the title is a link, add it as a link
            if (data.link !== undefined && data.link.length > 0) {
              header.innerHTML = `<a href="${data.link}">${data.title}</a> ${description}`;
              // row.appendChild(link);
            } else {
              header.innerHTML = data.title + description;
            }

            // Add two links. vorgelSprial.svg and evenSpiral.svg
            // These two files are in the same folder as the JSON files, and always exist 
            header.appendChild(document.createTextNode(' '));
            const voronoiLink = document.createElement('a');
            voronoiLink.href = `./images/${folder}/VogelSpiral.svg`;
            voronoiLink.innerHTML = 'Voronoi Spiral';
            voronoiLink.target = '_blank';
            header.appendChild(voronoiLink);

            header.appendChild(document.createTextNode(' '));
            const evenLink = document.createElement('a');
            evenLink.href = `./images/${folder}/evenSpiral.svg`;
            evenLink.innerHTML = 'Even Spiral';
            evenLink.target = '_blank';
            header.appendChild(evenLink);
            header.appendChild(document.createTextNode(' '));

            header.appendChild(document.createTextNode(' '));
            const outputLink = document.createElement('a');
            outputLink.href = `./images/${folder}/output.svg`;
            outputLink.innerHTML = 'Day output';
            outputLink.target = '_blank';
            header.appendChild(outputLink);
            header.appendChild(document.createTextNode(' '));
          }
        })
        .catch(err => console.error(`Error loading [./images/${folder}/settings.json]:`, err));

      const grid = document.createElement('div');
      grid.className = 'color-grid';
      row.appendChild(grid);

      // Get the average colors from output.json
      fetch(`./images/${folder}/output.json`)
        .then(res => res.json())
        .then(data => {
          data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'color-box';
            const avg = item.average;
            const fill = avg.a !== undefined
              ? `rgba(${avg.r},${avg.g},${avg.b},${(avg.a / 255).toFixed(2)})`
              : `rgb(${avg.r},${avg.g},${avg.b})`;
            div.style.backgroundColor = fill;
            div.title = item.file;
            grid.appendChild(div);
          });
        })
        .catch(err => console.error(`Error loading [./images/${folder}/output.json]:`, err));

      document.body.appendChild(row);
    });
  </script>
</body>

</html>